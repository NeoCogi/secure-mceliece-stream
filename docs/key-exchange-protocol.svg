<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <!-- Title -->
  <text x="400" y="30" font-family="Arial, sans-serif" font-size="20" font-weight="bold" text-anchor="middle">
    McEliece Key Exchange Protocol
  </text>

  <!-- Client and Server labels -->
  <text x="150" y="70" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle">
    Client (Initiator)
  </text>
  <text x="650" y="70" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle">
    Server (Responder)
  </text>

  <!-- Vertical lifelines -->
  <line x1="150" y1="80" x2="150" y2="550" stroke="black" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="650" y1="80" x2="650" y2="550" stroke="black" stroke-width="2" stroke-dasharray="5,5"/>

  <!-- Step 1: Client generates keypair -->
  <rect x="50" y="100" width="200" height="50" fill="#e8f4fd" stroke="#0066cc" stroke-width="2" rx="5"/>
  <text x="150" y="125" font-family="Arial, sans-serif" font-size="12" text-anchor="middle">
    Generate KeyPair
  </text>
  <text x="150" y="140" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
    (30-60 seconds)
  </text>

  <!-- Step 2: Send public key -->
  <line x1="150" y1="160" x2="640" y2="190" stroke="#0066cc" stroke-width="2" marker-end="url(#arrowblue)"/>
  <text x="400" y="170" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#0066cc">
    PublicKeyMessage (524KB)
  </text>
  <text x="400" y="185" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
    Protocol: PublicKey(pk)
  </text>

  <!-- Step 3: Server encapsulates -->
  <rect x="550" y="200" width="200" height="70" fill="#fef4e8" stroke="#cc6600" stroke-width="2" rx="5"/>
  <text x="650" y="220" font-family="Arial, sans-serif" font-size="12" text-anchor="middle">
    1. Validate public key
  </text>
  <text x="650" y="235" font-family="Arial, sans-serif" font-size="12" text-anchor="middle">
    2. Generate shared secret
  </text>
  <text x="650" y="250" font-family="Arial, sans-serif" font-size="12" text-anchor="middle">
    3. Encapsulate with KEM
  </text>
  <text x="650" y="265" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
    encapsulate(pk) → (ct, ss)
  </text>

  <!-- Step 4: Send encapsulated key -->
  <line x1="650" y1="280" x2="160" y2="310" stroke="#cc6600" stroke-width="2" marker-end="url(#arroworange)"/>
  <text x="400" y="290" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#cc6600">
    EncapsulatedKey (188B)
  </text>
  <text x="400" y="305" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
    Protocol: EncapsulatedKey(ct)
  </text>

  <!-- Step 5: Client decapsulates -->
  <rect x="50" y="320" width="200" height="70" fill="#e8f4fd" stroke="#0066cc" stroke-width="2" rx="5"/>
  <text x="150" y="340" font-family="Arial, sans-serif" font-size="12" text-anchor="middle">
    1. Decapsulate ciphertext
  </text>
  <text x="150" y="355" font-family="Arial, sans-serif" font-size="12" text-anchor="middle">
    2. Derive shared secret
  </text>
  <text x="150" y="370" font-family="Arial, sans-serif" font-size="12" text-anchor="middle">
    3. Initialize AES-256-GCM
  </text>
  <text x="150" y="385" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
    decapsulate(sk, ct) → ss
  </text>

  <!-- Step 6: Handshake complete from client -->
  <line x1="150" y1="400" x2="640" y2="430" stroke="#00cc00" stroke-width="2" marker-end="url(#arrowgreen)"/>
  <text x="400" y="410" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#00cc00">
    HandshakeComplete
  </text>
  <text x="400" y="425" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
    Protocol: HandshakeComplete
  </text>

  <!-- Step 7: Server derives cipher -->
  <rect x="550" y="440" width="200" height="40" fill="#fef4e8" stroke="#cc6600" stroke-width="2" rx="5"/>
  <text x="650" y="455" font-family="Arial, sans-serif" font-size="12" text-anchor="middle">
    Derive AES-256-GCM
  </text>
  <text x="650" y="470" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
    SHA3-256(ss) → key
  </text>

  <!-- Step 8: Handshake complete from server -->
  <line x1="650" y1="490" x2="160" y2="520" stroke="#00cc00" stroke-width="2" marker-end="url(#arrowgreen)"/>
  <text x="400" y="500" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#00cc00">
    HandshakeComplete
  </text>
  <text x="400" y="515" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
    Protocol: HandshakeComplete
  </text>

  <!-- Final state -->
  <rect x="275" y="540" width="250" height="40" fill="#e8ffe8" stroke="#00cc00" stroke-width="2" rx="5"/>
  <text x="400" y="560" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#00cc00">
    Secure Channel Established
  </text>
  <text x="400" y="575" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
    AES-256-GCM with shared secret
  </text>

  <!-- Arrow definitions -->
  <defs>
    <marker id="arrowblue" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#0066cc"/>
    </marker>
    <marker id="arroworange" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#cc6600"/>
    </marker>
    <marker id="arrowgreen" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#00cc00"/>
    </marker>
  </defs>
</svg>